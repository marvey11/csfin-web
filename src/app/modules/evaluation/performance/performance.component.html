<div class="container">
  <div class="card">
    <h1 class="card-header">Performance Evaluation</h1>
    <div class="card-body">
      <form [formGroup]="form">
        <div class="d-flex align-items-center py-2 mx-0 my-3" style="background-color: lightgray">
          <label for="interval-selector" class="p-2">Select Interval:</label>
          <div class="p-2 flex-grow">
            <select
              id="interval-selector"
              class="form-control"
              [formControl]="intervalSelector"
              (ngModelChange)="onChange($event)"
            >
              <option *ngFor="let intvl of intervals" [ngValue]="intvl">{{ intvl.label }}</option>
            </select>
          </div>
          <div class="ms-auto p-2">
            <input
              id="grouping-toggle"
              class="form-check-input"
              type="checkbox"
              [formControl]="groupingToggle"
              value=""
            />
            <label class="form-check-label mx-2" for="grouping-toggle">Group Securities by Type</label>
          </div>
        </div>
      </form>

      <table class="table table-striped table-hover" *ngIf="(isLoading | async) === false">
        <thead>
          <tr>
            <th scope="col">ISIN</th>
            <th scope="col">Name</th>
            <th scope="col" class="text-center" *ngIf="groupingEnabled === false">Type</th>
            <th scope="col">Exchange</th>
            <th scope="col">Date</th>
            <th scope="col" style="text-align: right">Performance</th>
          </tr>
        </thead>
        <ng-template [ngIf]="groupingEnabled" [ngIfElse]="nogroups">
          <tbody *ngFor="let group of groupedItems | keyvalue">
            <tr class="group-header">
              <th scope="row" colspan="5">{{ getLabel(group.key, true) || "Unkown" }}</th>
            </tr>
            <tr *ngFor="let item of getSortedItems(group.value)">
              <td>
                <span class="mono-fixed fw-bold text-muted">{{ item.isin }}</span>
              </td>
              <td>{{ item.name }}</td>
              <td>{{ item.exchange }}</td>
              <td>{{ item.newestDate.toDateString() }}</td>
              <td style="text-align: right">{{ getPerformance(item) | number: "1.2-2" }} %</td>
            </tr>
          </tbody>
        </ng-template>
        <ng-template #nogroups>
          <tbody>
            <tr *ngFor="let item of getSortedItems(performanceItems)">
              <td>
                <span class="mono-fixed fw-bold text-muted">{{ item.isin }}</span>
              </td>
              <td>{{ item.name }}</td>
              <td class="text-center">{{ getLabel(item.type) }}</td>
              <td>{{ item.exchange }}</td>
              <td>{{ item.newestDate.toDateString() }}</td>
              <td style="text-align: right">{{ getPerformance(item) | number: "1.2-2" }} %</td>
            </tr>
          </tbody>
        </ng-template>
      </table>

      <app-loader message="Loading performance data..."></app-loader>
    </div>
  </div>
</div>
